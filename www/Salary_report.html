<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyGaji</title>
    <link rel="icon" href="src/APB.png">
    <link rel="apple-touch-icon" href="src/APB.png">

<!-- Google Font: Source Sans Pro -->
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
<!-- Font Awesome Icons -->
<link rel="stylesheet" href="css/css/all.min.css">
<script src="https://kit.fontawesome.com/b9ae426220.js" crossorigin="anonymous"></script>
<!-- Theme style -->
<link rel="stylesheet" href="css/adminlte.min.css">

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        table {
            width: 100%; /* Make the table span the full width of the screen */
            margin: 20px 0;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #000;
            padding: 8px;
            text-align: left;
            white-space: nowrap; /* Prevent content from wrapping */
        }
        th {
            background-color: #f2f2f2;
        }
        .header {
            display: flex;
            align-items: flex-start;
            gap: 20px;
        }
        .header img {
            width: 100px;
            height: 100px;
            object-fit: contain;
            opacity: 0.8;
        }
    </style>
    <script type="module">
        import { db } from './calculation.js';
        import { getDocs, collection } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

        const salariesRef = collection(db, 'salaries'); // Reference to the salaries collection

        // Salary Deduction Constants
        const S_KWSP = 187;
        const S_socso = 8.25;
        const S_EIS = 3.30;

        async function fetchSalaryReport() {
            const querySnapshot = await getDocs(salariesRef);
            let tableRows = '';

            querySnapshot.forEach((doc) => {
                const salaryData = doc.data();
                tableRows += `
                    <tr>
                        <td>${salaryData.employeeId}</td>
                        <td>${salaryData.nama}</td>
                        <td>RM 1700</td> <!-- Base salary -->
                        <td>${salaryData.unpaidLeave || 0}</td>
                        <td>RM ${S_KWSP.toFixed(2)}</td>
                        <td>RM ${S_socso.toFixed(2)}</td>
                        <td>RM ${S_EIS.toFixed(2)}</td>
                        <td>${salaryData.publicHoliday || 0}</td>
                        <td>${salaryData.overtime || 0}</td>
                        <td>RM ${(salaryData.overtime * 10 || 0).toFixed(2)}</td> <!-- Overtime total -->
                        <td>RM ${salaryData.totalSalary}</td>
                    </tr>
                `;
            });

            document.querySelector('tbody').innerHTML = tableRows;

            // Notify the parent window that the report is ready
            setTimeout(() => {
                window.opener.postMessage('reportReady', '*');
            }, 500); // Add a slight delay to ensure rendering is complete
        }

        fetchSalaryReport();
    </script>
</head>
<body style="margin: 20px;">
    <div class="header">
        <img src="src/APB.png" alt="APB Logo">
        <div>
            <h1 class="mb-5px font-weight-bold">Ayam Penyet Best</h1>
            <h5 class="m-1" style="font-size: small;">Address: L3-33A, 3rd Floor Mayang Mall, 20000 Kuala Terengganu, Terengganu</h5>
            <div style="display: flex; gap: 76px;">
                <h5 class="m-1" style="font-size: small;">Email : hahha@gamil.com</h5>
                <h5 class="m-1" style="font-size: small;">Phone : 016-410 3533 / 011-2337 1228</h5>
            </div>
        </div>
    </div>
    <table>
        <thead>
            <tr>
                <th rowspan="3">Employee ID</th>
                <th rowspan="3">Name</th>
                <th rowspan="3">Base Salary</th>
                <th colspan="4" class="text-center">Deduction</th>
                <th colspan="3" class="text-center">Addition</th>
                <th rowspan="3">Total Salary</th>
            </tr>
            <tr>
                <th rowspan="2">Unpaid Leave</th>
                <th rowspan="2">KWSP</th>
                <th rowspan="2">SOCSO</th>
                <th rowspan="2">EIS</th>
                <th rowspan="2">Public Holiday</th>
                <th colspan="2">Overtime</th>
            </tr>
            <tr>
                <th>Hours</th>
                <th>Total</th>
            </tr>
        </thead>
        <tbody>
            <!-- Rows will be dynamically populated -->
        </tbody>
    </table>
</body>
</html>